function hex2rgb(a){if("object"==typeof a&&3===a.length||"string"!==typeof a)return a;var d,e;a=a.match(/[a-fA-F0-9]{2}/g);d=a[0];e=a[1];a=a[2];return[parseInt(d,16),parseInt(e,16),parseInt(a,16)]}
function Colr(a){if("object"===typeof a&&cssClr instanceof Colr)this._css=a._css,this.clr=a.clr.slice(),this.type=a.type;else{"string"!=typeof a&&(a=Colr.random());this.type="rgb";this._css=a;this.clr=[];a=a.replace(/^#/,"");if(val=a.match(/rgba\s*\(([^,]+),([^,]+),([^,]+),([^)]+)\)/))r=val[1],g=val[2],b=val[3],o=val[4],c=[parseInt(r,10),parseInt(g,10),parseInt(b,10),parseFloat(o)];else if(val=a.match(/rgb\s*\(([^,]+),([^,]+),([^)]+)\)/))r=val[1],g=val[2],b=val[3],c=[parseInt(r,10),parseInt(g,10),
parseInt(b,10),1];else if(val=a.match(/hsla\s*\(([^,]+),([^,]+),([^,]+),([^)]+)\)/))this.type="hsl",val.shift(),val[0]=parseInt(val[0],10),val[1]=parseInt(val[1],10),val[2]=parseInt(val[2],10),c=val,c.push(parseFloat(val[3]));else if(val=a.match(/hsl\s*\(([^,]+),([^,]+),([^)]+)\)/))this.type="hsl",val.shift(),val[0]=parseInt(val[0],10),val[1]=parseInt(val[1],10),val[2]=parseInt(val[2],10),c=val,c.push(1);else if(a.match(/^[a-fA-F0-9]{6}$/))c=hex2rgb(a),c.push(1);else if(val=a.match(/^[a-fA-F0-9]{3}$/))val=
val[0].split(""),r=val[0],g=val[1],b=val[2],r=parseInt(r,16),g=parseInt(g,16),b=parseInt(b,16),r=16*r+r,g=16*g+g,b=16*b+b,c=[r,g,b,1];this.clr=c}}Colr.prototype.clone=function(){return new Colr(this)};
Colr.prototype.blend=function(a,d){"undefined"==typeof d&&(d=0.5);d=Math.max(0,Math.min(1,d));a=new Colr(a);var e=new Colr,f,h;clr1=this.clr;clr2=a.clr;if(!clr1||!clr2)return new Colr(this);for(f=0;3>f;f++)h=clr2[f]-clr1[f],e.clr[f]=clr1[f]+h*d,this.DEBUG&&_console.log("Colour.blend",clr1[f],clr2[f],h,e[f]);e.type="rgb";return e};
Colr.prototype.blendhsl=function(a,d){"undefined"==typeof d&&(d=0.5);d=Math.max(0,Math.min(1,d));a=(new Colr(a)).hsl();var e=(new Colr).hsl(),f,h;clr1=this.clr;clr2=a.clr;if(!clr1||!clr2)return new Colr(this);for(f=0;3>f;f++)h=clr2[f]-clr1[f],e.clr[f]=clr1[f]+h*d,this.DEBUG&&_console.log("Colour.blend",clr1[f],clr2[f],h,e[f]);e.type="hsl";return e};Colr.prototype.darken=function(a){"undefined"==typeof a&&(a=0.5);var d=this.hsl();d.clr[2]*=1-a;return d};
Colr.prototype.lighten=function(a){"undefined"==typeof a&&(a=0.5);var d=this.hsl();d.clr[2]+=d.clr[2]*a;return d};Colr.prototype.css=function(){switch(this.type){case "hsl":this._css="hsla("+this.clr[0]+", "+this.clr[1]+"%, "+this.clr[2]+"%, "+this.clr[3]+")";break;case "rgb":this._css="rgba("+parseInt(this.clr[0],10)+", "+parseInt(this.clr[1],10)+", "+parseInt(this.clr[2],10)+", "+this.clr[3]+")"}return this._css};
Colr.prototype.hsl=function(){if("hsl"==this.type)return this;var a=this.clr.slice(),d,e,f,h,j,k;for(d=0;3>d;d++)a[d]/=255;d=a[0];e=a[1];f=a[2];j=Math.max(d,e,f);k=Math.min(d,e,f);a=j-k;if(0===a)d=h=0;else switch(j){case d:d=(e-f)/a%6;break;case e:d=(f-d)/a+2;break;case f:d=(d-e)/a+4;break;default:d=h=0}e=(j+k)/2;void 0===h&&(h=0===a?0:0.5>=e?a/(2*e):a/(2-2*e));this.type="hsl";this.clr=[60*d,100*h,100*e,1];return this};
Colr.prototype.rgb=function(){if("rgb"==this.type)return this;var a,d,e,f,h,j,k;hsl=this.clr.slice();a=hsl[0];e=hsl[1]/100;d=hsl[2]/100;j=0.5>=d?2*d*e:(2-2*d)*e;a/=60;e=j*(1-Math.abs(a%2-1));k=d-j/2;d=f=h=0;1>a?(d=j,f=e):2>a?(d=e,f=j):3>a?(f=j,h=e):4>a?(f=e,h=j):5>a?(d=e,h=j):6>a&&(d=j,h=e);a=[d+k,f+k,h+k];for(e=0;3>e;e++)a[e]*=255;a[3]=hsl[3];this.type="rgb";this.clr=a;return this};Colr.prototype.hue=function(a){this.hsl();return"undefined"!==typeof a?(this.clr[0]=a,this):this.clr[0]};
Colr.prototype.sat=function(a){this.hsl();return"undefined"!==typeof a?(this.clr[1]=a,this):this.clr[1]};Colr.prototype.light=function(a){this.hsl();return"undefined"!==typeof a?(this.clr[2]=a,this):this.clr[2]};Colr.prototype.alpha=function(a){return"undefined"!==typeof a?(this.clr[3]=a,this):this.clr[3]};Colr.prototype.red=function(a){this.rgb();return"undefined"!==typeof a?(this.clr[0]=a,this):this.clr[0]};
Colr.prototype.green=function(a){this.rgb();return"undefined"!==typeof a?(this.clr[1]=a,this):this.clr[1]};Colr.prototype.blue=function(a){this.rgb();return"undefined"!==typeof a?(this.clr[2]=a,this):this.clr[2]};Colr.random=function(){return"hsl("+Math.floor(360*Math.random())+", "+Math.floor(100*Math.random())+"%, "+Math.floor(100*Math.random())+"%)"};
